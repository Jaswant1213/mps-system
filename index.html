<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Mehran Public School | Management System</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Great+Vibes&family=Dancing+Script:wght@600&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <link rel="stylesheet" href="css/style.css" />

    <style>
      .dashboard-row {
        display: flex;
        gap: 20px;
        align-items: flex-start;
      }
      @media (max-width: 768px) {
        .dashboard-row {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div id="login-screen" class="login-container">
      <div class="login-wrapper">
        <div class="login-header">
          <div class="logo-circle">
            <i class="fa-solid fa-graduation-cap"></i>
          </div>
          <h2>The Mehran Public School</h2>
          <p>Naukot | Management System</p>
        </div>

        <form id="login-form" class="login-form">
          <div class="input-group">
            <i class="fa-regular fa-user input-icon"></i>
            <input type="text" id="username" placeholder="Username" required />
          </div>

          <div class="input-group">
            <i class="fa-solid fa-lock input-icon"></i>
            <input
              type="password"
              id="password"
              placeholder="Password"
              required
            />
          </div>

          <button type="submit" class="btn-login">Sign In</button>

          <p id="login-error" class="error-msg hidden">
            <i class="fa-solid fa-circle-exclamation"></i> Invalid Username or
            Password
          </p>
        </form>

        <div class="login-footer">
          <p>Authorized Personnel Only</p>
        </div>
      </div>
    </div>

    <div class="dashboard-container">
      <aside class="sidebar" id="sidebar">
        <button id="close-sidebar-btn" class="close-sidebar-btn">
          <i class="fa-solid fa-xmark"></i>
        </button>
        <div class="sidebar-header">
          <i class="fa-solid fa-graduation-cap fa-2x"></i>
          <h3>
            The Mehran Public<br />
            School<br /><span
              style="font-size: 0.8em; font-weight: 400; opacity: 0.8"
              >Naukot</span
            >
          </h3>
        </div>

        <nav class="sidebar-nav">
          <a
            href="#"
            class="nav-link"
            id="nav-dash"
            onclick="switchTab('dashboard')"
          >
            <i class="fa-solid fa-house"></i> Dashboard
          </a>

          <a
            href="#"
            class="nav-link"
            id="nav-fee"
            onclick="
              switchTab('fee-collection');
              loadFeeClasses();
            "
          >
            <i class="fa-solid fa-hand-holding-dollar"></i> Collect Fee
          </a>

          <div id="admin-links">
            <a
              href="#"
              class="nav-link"
              id="nav-std"
              onclick="switchTab('student-mgmt')"
            >
              <i class="fa-solid fa-users"></i> Students
            </a>
            <a
              href="#"
              class="nav-link"
              id="nav-res"
              onclick="switchTab('results')"
            >
              <i class="fa-solid fa-file-pen"></i> Exam Results
            </a>
            <a
              href="#"
              class="nav-link"
              id="nav-cert"
              onclick="
                switchTab('certificates');
                loadCertClasses();
              "
            >
              <i class="fa-solid fa-certificate"></i> Certificates
            </a>
            <a
              href="#"
              class="nav-link"
              id="nav-rep"
              onclick="switchTab('reports')"
            >
              <i class="fa-solid fa-file-invoice-dollar"></i> Reports
            </a>

            <a
              href="#"
              class="nav-link"
              id="nav-users"
              onclick="switchTab('user-mgmt')"
            >
              <i class="fa-solid fa-user-gear"></i> Staff & Admin
            </a>
          </div>

          <a href="#" class="nav-link logout" onclick="logout()">
            <i class="fa-solid fa-right-from-bracket"></i> Logout
          </a>
        </nav>
      </aside>

      <main class="main-content">
        <header class="mobile-header">
          <button id="menu-toggle"><i class="fa-solid fa-bars"></i></button>
          <span>The Mehran Public School Naukot</span>
        </header>

        <div id="main-display-area">
          <section id="tab-dashboard" class="tab-content">
            <div class="module-header">
              <div>
                <h2>Dashboard Overview</h2>
                <p style="color: var(--text-muted)">
                  Welcome back, here's what's happening today.
                </p>
              </div>
            </div>

            <div class="stats-grid">
              <div class="stat-card">
                <div
                  class="stat-icon"
                  style="background: #e0f2fe; color: #0284c7"
                >
                  <i class="fa-solid fa-user-graduate"></i>
                </div>
                <div>
                  <h3 id="dash-total-students">0</h3>
                  <p>Total Students</p>
                </div>
              </div>

              <div class="stat-card">
                <div
                  class="stat-icon"
                  style="background: #fef3c7; color: #d97706"
                >
                  <i class="fa-solid fa-chalkboard-user"></i>
                </div>
                <div>
                  <h3 id="dash-total-staff">0</h3>
                  <p>Active Staff</p>
                </div>
              </div>

              <div class="stat-card">
                <div
                  class="stat-icon"
                  style="background: #dcfce7; color: #16a34a"
                >
                  <i class="fa-solid fa-sack-dollar"></i>
                </div>
                <div>
                  <h3 id="dash-income">0 PKR</h3>
                  <p>Income (This Month)</p>
                </div>
              </div>
            </div>

            <div class="recent-grid">
              <div class="projects">
                <div
                  class="card-header"
                  style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    border-bottom: 1px solid #e2e8f0;
                    padding-bottom: 15px;
                    margin-bottom: 15px;
                  "
                >
                  <h3 style="margin: 0; color: #1e293b; font-size: 1.2rem">
                    Recent Fee Payments
                  </h3>

                  <button
                    onclick="switchTab('reports')"
                    style="
                      background: #e0f2fe;
                      color: #0369a1;
                      border: none;
                      padding: 8px 16px;
                      border-radius: 30px;
                      font-size: 0.85rem;
                      font-weight: 600;
                      cursor: pointer;
                      display: flex;
                      align-items: center;
                      gap: 8px;
                      transition: all 0.2s ease;
                    "
                    onmouseover="this.style.background = '#bae6fd'"
                    onmouseout="this.style.background = '#e0f2fe'"
                  >
                    See all
                    <i
                      class="fa-solid fa-arrow-right"
                      style="font-size: 0.8em"
                    ></i>
                  </button>
                </div>

                <div class="table-responsive">
                  <table width="100%">
                    <thead>
                      <tr style="border-bottom: 1px solid #e2e8f0">
                        <th
                          style="
                            text-align: left;
                            padding: 15px 12px;
                            color: #64748b;
                            font-size: 0.8rem;
                            font-weight: 700;
                            text-transform: uppercase;
                            letter-spacing: 0.5px;
                          "
                        >
                          Student Name
                        </th>
                        <th
                          style="
                            text-align: left;
                            padding: 15px 12px;
                            color: #64748b;
                            font-size: 0.8rem;
                            font-weight: 700;
                            text-transform: uppercase;
                            letter-spacing: 0.5px;
                          "
                        >
                          Class
                        </th>
                        <th
                          style="
                            text-align: left;
                            padding: 15px 12px;
                            color: #64748b;
                            font-size: 0.8rem;
                            font-weight: 700;
                            text-transform: uppercase;
                            letter-spacing: 0.5px;
                          "
                        >
                          Amount
                        </th>
                        <th
                          style="
                            text-align: left;
                            padding: 15px 12px;
                            color: #64748b;
                            font-size: 0.8rem;
                            font-weight: 700;
                            text-transform: uppercase;
                            letter-spacing: 0.5px;
                          "
                        >
                          Receiver
                        </th>
                      </tr>
                    </thead>
                    <tbody id="recent-tx-body"></tbody>
                  </table>
                </div>
              </div>

              <div
                class="form-card"
                style="
                  flex: 1;
                  min-width: 200px;
                  padding: 15px;
                  background: #fff7ed;
                  border: 1px solid #ffedd5;
                "
              >
                <h4 style="color: #c2410c; margin-bottom: 15px">
                  <i class="fa-solid fa-bell"></i> Alerts
                </h4>

                <div
                  style="
                    display: flex;
                    align-items: center;
                    gap: 15px;
                    margin-bottom: 10px;
                  "
                >
                  <span style="font-weight: 500">Paid Students:</span>
                  <strong
                    id="stat-paid-count"
                    style="color: #16a34a; font-size: 1.2rem"
                    >0</strong
                  >
                </div>

                <div
                  style="
                    display: flex;
                    align-items: center;
                    gap: 15px;
                    margin-bottom: 10px;
                  "
                >
                  <span style="font-weight: 500">Unpaid Students:</span>
                  <strong
                    id="stat-unpaid-count"
                    style="color: var(--danger, red); font-size: 1.2rem"
                    >0</strong
                  >
                </div>

                <p
                  style="
                    font-size: 0.85rem;
                    color: #666;
                    margin-bottom: 20px;
                    margin-top: 10px;
                  "
                >
                  Total status for the current month.
                </p>

                <button
                  onclick="switchTab('fee-collection')"
                  class="btn-primary"
                  style="width: 100%"
                >
                  Collect Fee Now
                </button>
              </div>
            </div>
          </section>

          <section id="tab-student-mgmt" class="tab-content hidden">
            <div class="module-header">
              <h2>Students Database</h2>
              <button class="btn-primary" onclick="openStudentModal()">
                <i class="fa-solid fa-plus"></i> New Admission
              </button>
            </div>
            <div id="class-cards-container" class="cards-grid"></div>

            <div id="class-detail-view" class="hidden">
              <div class="print-header">
                <h1>THE MEHRAN PUBLIC SCHOOL NAUKOT</h1>
                <p>Student List Report</p>
              </div>
              <div
                class="screen-controls"
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 20px;
                "
              >
                <button onclick="backToClasses()" class="btn-sm">
                  <i class="fa-solid fa-arrow-left"></i> Back
                </button>
                <h3 id="class-title" style="color: var(--primary); margin: 0">
                  Class Details
                </h3>
                <button onclick="window.print()" class="btn-sm no-print">
                  <i class="fa-solid fa-print"></i> Print List
                </button>
              </div>

              <div class="filter-bar no-print">
                <div style="flex: 1; min-width: 200px">
                  <label
                    ><i class="fa-solid fa-magnifying-glass"></i> Search:</label
                  >
                  <input
                    type="text"
                    id="search-student"
                    placeholder="Enter Name or Roll No..."
                    onkeyup="searchStudentTable()"
                  />
                </div>
                <div style="display: flex; align-items: center; gap: 10px">
                  <label>Month:</label>
                  <select
                    id="filter-month"
                    onchange="applyClassFilters()"
                  ></select>
                  <select id="filter-year" onchange="applyClassFilters()">
                    <option value="2026">2026</option>
                    <option value="2027">2027</option>
                  </select>
                </div>
                <div style="display: flex; align-items: center; gap: 10px">
                  <label>Status:</label>
                  <select id="filter-status" onchange="applyClassFilters()">
                    <option value="All">All</option>
                    <option value="Unpaid">Unpaid</option>
                    <option value="Paid">Paid</option>
                  </select>
                </div>
              </div>

              <div class="table-container printable-area">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Roll</th>
                      <th>Student Info</th>
                      <th>Father Name</th>
                      <th>Contact</th>
                      <th>Fee Status</th>
                      <th class="no-print">Action</th>
                    </tr>
                  </thead>
                  <tbody id="student-list-body"></tbody>
                </table>
              </div>
            </div>
          </section>

          <section id="tab-fee-collection" class="tab-content hidden">
            <div class="module-header">
              <h2>Fee Collection</h2>
            </div>
            <div class="fee-flex">
              <div class="form-card selection-box">
                <h4 style="margin-bottom: 15px; color: var(--primary)">
                  1. Select Student
                </h4>
                <div class="form-grid">
                  <div>
                    <label>Class:</label>
                    <select
                      id="fee-class-select"
                      onchange="filterFeeStudents()"
                    ></select>
                  </div>
                  <div>
                    <label>Student:</label>
                    <select id="fee-std-select" onchange="updateDefaultFee()">
                      <option value="">Select Class First</option>
                    </select>
                  </div>
                  <div>
                    <label>Month:</label>
                    <select id="fee-month">
                      <option value="January">January</option>
                      <option value="February">February</option>
                      <option value="March">March</option>
                      <option value="April">April</option>
                      <option value="May">May</option>
                      <option value="June">June</option>
                      <option value="July">July</option>
                      <option value="August">August</option>
                      <option value="September">September</option>
                      <option value="October">October</option>
                      <option value="November">November</option>
                      <option value="December">December</option>
                    </select>
                  </div>
                  <div>
                    <label>Year:</label>
                    <select id="fee-year">
                      <option value="2026">2026</option>
                      <option value="2027">2027</option>
                    </select>
                  </div>
                  <div class="full-width">
                    <label>Amount (PKR):</label>
                    <input
                      type="number"
                      id="manual-fee-input"
                      placeholder="0"
                    />
                  </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px">
                  <button
                    class="btn-success"
                    onclick="quickPay()"
                    style="flex: 1"
                  >
                    <i class="fa-solid fa-check"></i> Mark as Paid
                  </button>
                  <button
                    class="btn-primary"
                    onclick="addToBasket()"
                    style="flex: 1"
                  > 
                    <i class="fa-solid fa-cart-plus"></i> Add Sibling
                  </button>
                </div>
              </div>
              <div class="form-card basket-box">
                <h4 style="margin-bottom: 15px; color: var(--primary)">
                  2. Payment Basket
                </h4>
                <div id="basket-items-list"></div>
                <div class="total-row">
                  Total: <span id="basket-total">0</span> PKR
                </div>
                <button
                  class="btn-success btn-large"
                  onclick="processPayment()"
                >
                  Process Payment <i class="fa-solid fa-arrow-right"></i>
                </button>
              </div>
            </div>
          </section>

          <section id="tab-certificates" class="tab-content hidden">
            <div class="module-header">
              <div>
                <h2>Issue Certificates</h2>
                <p style="color: var(--text-muted)">
                  Generate School Leaving Certificates (SLC) and Character
                  Certificates.
                </p>
              </div>
            </div>

            <div class="form-card">
              <h3 style="color: var(--primary); margin-bottom: 20px">
                <i class="fa-solid fa-id-card"></i> Student Selection
              </h3>
              <div
                style="
                  display: flex;
                  gap: 15px;
                  flex-wrap: wrap;
                  align-items: flex-end;
                "
              >
                <div style="flex: 1">
                  <label>Select Class:</label>
                  <select
                    id="cert-class-select"
                    onchange="renderCertStudentList()"
                    style="
                      padding: 10px;
                      width: 100%;
                      border: 1px solid #ddd;
                      border-radius: 5px;
                    "
                  >
                    <option value="">-- Select Class --</option>
                  </select>
                </div>
                <div style="flex: 2">
                  <label>Select Student:</label>
                  <select
                    id="cert-student-select"
                    style="
                      padding: 10px;
                      width: 100%;
                      border: 1px solid #ddd;
                      border-radius: 5px;
                    "
                    disabled
                  >
                    <option value="">-- First Select Class --</option>
                  </select>
                </div>
                <button
                  class="btn-primary"
                  onclick="openCertForm()"
                  style="height: 42px"
                >
                  <i class="fa-solid fa-arrow-right"></i> Proceed
                </button>
              </div>
            </div>
            <div style="margin-top: 30px; text-align: center; color: #ccc">
              <i class="fa-solid fa-stamp fa-4x" style="opacity: 0.2"></i>
              <p style="margin-top: 10px">
                Select a student to generate their Leaving Certificate.
              </p>
            </div>
            <div class="section-divider"></div>

            <div class="module-header" style="margin-top: 30px">
              <h3>Issued Certificates History</h3>
              <button
                onclick="renderCertHistory(true)"
                class="btn-sm"
                style="
                  background: none;
                  border: none;
                  color: var(--primary);
                  cursor: pointer;
                "
              >
                <i class="fa-solid fa-rotate"></i> Refresh
              </button>
            </div>

            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Student Name</th>
                    <th>Father Name</th>
                    <th>Class</th>
                    <th>Type</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="cert-history-body"></tbody>
              </table>
            </div>
          </section>

          <section id="tab-reports" class="tab-content hidden">
            <div class="module-header">
              <h2>Financial History</h2>
            </div>
            <div
              class="form-card no-print"
              style="margin-bottom: 20px; padding: 15px; background: #fff"
            >
              <div
                style="
                  display: flex;
                  gap: 15px;
                  flex-wrap: wrap;
                  align-items: flex-end;
                "
              >
                <div style="flex: 1; min-width: 250px">
                  <label style="font-weight: 600; font-size: 0.9rem"
                    >Search Receipt:</label
                  >
                  <div
                    style="
                      display: flex;
                      border: 1px solid #ccc;
                      border-radius: 6px;
                      overflow: hidden;
                    "
                  >
                    <span
                      style="
                        padding: 8px 12px;
                        background: #f3f4f6;
                        color: #666;
                      "
                      ><i class="fa-solid fa-magnifying-glass"></i
                    ></span>
                    <input
                      type="text"
                      id="report-search"
                      placeholder="Enter ID or Name..."
                      onkeyup="renderReports()"
                      style="border: none; outline: none; padding: 8px; flex: 1"
                    />
                  </div>
                </div>
                <div>
                  <label style="font-weight: 600; font-size: 0.9rem"
                    >Class:</label
                  >
                  <select
                    id="report-filter-class"
                    onchange="renderReports()"
                    style="
                      padding: 8px;
                      border: 1px solid #ccc;
                      border-radius: 6px;
                      min-width: 150px;
                    "
                  >
                    <option value="">All Classes</option>
                  </select>
                </div>
                <div>
                  <label style="font-weight: 600; font-size: 0.9rem"
                    >Month:</label
                  >
                  <select
                    id="report-filter-month"
                    onchange="renderReports()"
                    style="
                      padding: 8px;
                      border: 1px solid #ccc;
                      border-radius: 6px;
                      min-width: 130px;
                    "
                  >
                    <option value="">All Months</option>
                    <option value="1">January</option>
                    <option value="2">February</option>
                    <option value="3">March</option>
                    <option value="4">April</option>
                    <option value="5">May</option>
                    <option value="6">June</option>
                    <option value="7">July</option>
                    <option value="8">August</option>
                    <option value="9">September</option>
                    <option value="10">October</option>
                    <option value="11">November</option>
                    <option value="12">December</option>
                  </select>
                </div>
                <div>
                  <button
                    onclick="resetReportFilters()"
                    class="btn-secondary"
                    style="
                      padding: 8px 15px;
                      border: 1px solid #ccc;
                      background: #f3f4f6;
                      cursor: pointer;
                      border-radius: 6px;
                      font-weight: 600;
                    "
                  >
                    <i class="fa-solid fa-rotate-left"></i> Reset
                  </button>
                </div>
              </div>
            </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th style="width: 15%">Receipt ID</th>
                    <th style="width: 15%">Date</th>
                    <th style="width: 20%">Student Name</th>
                    <th style="width: 10%">Class</th>
                    <th style="width: 15%">Paid Month</th>
                    <th style="width: 10%">Amount</th>
                    <th style="width: 15%">Action</th>
                  </tr>
                </thead>
                <tbody id="reports-list-body"></tbody>
              </table>
            </div>
          </section>

          <section id="tab-results" class="tab-content hidden">
            <div class="module-header">
              <div>
                <h2>Exam Management</h2>
                <p style="color: var(--text-muted)">
                  Manage subjects, marks, and print result cards.
                </p>
              </div>
            </div>
            <div
              class="stats-grid"
              style="
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
              "
            >
              <div
                class="stat-card"
                onclick="openSubjectModal()"
                style="border-left: 4px solid #4f46e5; cursor: pointer"
              >
                <div style="color: #666; font-size: 0.9rem; font-weight: 600">
                  STEP 1
                </div>
                <h3 style="color: #4f46e5; font-size: 1.2rem; margin-top: 10px">
                  Manage Subjects
                </h3>
                <p style="font-size: 0.8rem; color: #888">
                  Add subjects for each class.
                </p>
                <i class="fa-solid fa-book icon-bg"></i>
              </div>
              <div
                class="stat-card"
                onclick="openMarksEntry()"
                style="border-left: 4px solid #059669; cursor: pointer"
              >
                <div style="color: #666; font-size: 0.9rem; font-weight: 600">
                  STEP 2
                </div>
                <h3 style="color: #059669; font-size: 1.2rem; margin-top: 10px">
                  Enter Marks
                </h3>
                <p style="font-size: 0.8rem; color: #888">
                  Input exam scores for students.
                </p>
                <i class="fa-solid fa-pen-to-square icon-bg"></i>
              </div>
              <div
                class="stat-card"
                onclick="openResultView()"
                style="border-left: 4px solid #d97706; cursor: pointer"
              >
                <div style="color: #666; font-size: 0.9rem; font-weight: 600">
                  STEP 3
                </div>
                <h3 style="color: #d97706; font-size: 1.2rem; margin-top: 10px">
                  Generate Result
                </h3>
                <p style="font-size: 0.8rem; color: #888">
                  View and print marksheets.
                </p>
                <i class="fa-solid fa-print icon-bg"></i>
              </div>
            </div>
            <div id="result-workspace" class="form-card">
              <div style="text-align: center; padding: 40px; color: #999">
                <i
                  class="fa-solid fa-arrow-pointer fa-3x"
                  style="margin-bottom: 15px; opacity: 0.5"
                ></i>
                <p>Select an option from above to start.</p>
              </div>
            </div>
          </section>

          <section id="tab-user-mgmt" class="tab-content hidden">
            <div class="module-header">
              <div>
                <h2>Staff Management</h2>
                <p style="color: var(--text-muted)">
                  Manage access for Teachers and Admins.
                </p>
              </div>
              <button class="btn-primary" onclick="openUserModal()">
                <i class="fa-solid fa-user-plus"></i> Add New Staff
              </button>
            </div>
            <div class="form-card">
              <h4
                style="
                  margin-bottom: 20px;
                  color: var(--primary);
                  border-bottom: 1px solid #eee;
                  padding-bottom: 10px;
                "
              >
                <i class="fa-solid fa-users-gear"></i> Active Accounts
              </h4>
              <div class="table-container">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Username</th>
                      <th>Role</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody id="user-list-body"></tbody>
                </table>
              </div>
            </div>
            <div class="section-divider"></div>
            <div class="module-header">
              <div>
                <h2>Database Backup</h2>
                <p style="color: var(--text-muted); font-size: 0.9rem">
                  Securely save or restore your school data.
                </p>
              </div>
            </div>
            <div class="backup-grid">
              <div class="backup-card card-export">
                <div class="card-content">
                  <div class="icon-box export-icon">
                    <i class="fa-solid fa-cloud-arrow-down"></i>
                  </div>
                  <div>
                    <h4>Export Data</h4>
                    <p>Download complete backup (.json).</p>
                  </div>
                </div>
                <button class="btn-primary btn-full" onclick="backupData()">
                  <i class="fa-solid fa-download"></i> Download
                </button>
              </div>
              <div class="backup-card card-restore">
                <div class="card-content">
                  <div class="icon-box restore-icon">
                    <i class="fa-solid fa-cloud-arrow-up"></i>
                  </div>
                  <div>
                    <h4>Restore Data</h4>
                    <p>
                      <span class="warning-text"
                        >Current data will be replaced.</span
                      >
                    </p>
                  </div>
                </div>
                <input
                  type="file"
                  id="backup-file-input"
                  accept=".json"
                  style="display: none"
                  onchange="restoreData(this)"
                />
                <button
                  class="btn-danger btn-full"
                  onclick="document.getElementById('backup-file-input').click()"
                >
                  <i class="fa-solid fa-upload"></i> Restore
                </button>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <div id="student-modal" class="modal-overlay hidden">
      <div class="form-card" style="width: 600px; max-width: 95%">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
          "
        >
          <h3 style="color: var(--primary)">Admission</h3>
          <button
            onclick="closeStudentModal()"
            style="
              background: none;
              border: none;
              font-size: 1.5rem;
              cursor: pointer;
            "
          >
            &times;
          </button>
        </div>
        <input type="hidden" id="edit-student-id" />
        <div class="form-grid">
          <div>
            <label>Name <span style="color: red">*</span></label>
            <input
              type="text"
              id="new-name"
              placeholder="Student Name"
              oninput="clearError('name')"
            />
            <small
              id="err-name"
              style="
                color: #dc2626;
                font-size: 0.8rem;
                display: none;
                margin-top: 4px;
              "
            >
              <i class="fa-solid fa-circle-exclamation"></i> Name is required
            </small>
          </div>

          <div>
            <label>Father Name <span style="color: red">*</span></label>
            <input
              type="text"
              id="new-father"
              placeholder="Father Name"
              oninput="clearError('father')"
            />
            <small
              id="err-father"
              style="
                color: #dc2626;
                font-size: 0.8rem;
                display: none;
                margin-top: 4px;
              "
            >
              <i class="fa-solid fa-circle-exclamation"></i> Father Name is
              required
            </small>
          </div>

          <div>
            <label>Caste <span style="color: red">*</span></label>
            <input
              type="text"
              id="new-caste"
              placeholder="Caste"
              oninput="clearError('caste')"
            />
            <small
              id="err-caste"
              style="
                color: #dc2626;
                font-size: 0.8rem;
                display: none;
                margin-top: 4px;
              "
            >
              <i class="fa-solid fa-circle-exclamation"></i> Caste is required
            </small>
          </div>

          <div>
            <label>Class <span style="color: red">*</span></label>
            <select id="new-class-select"></select>
          </div>

          <div>
            <label>Contact <span style="color: red">*</span></label>
            <input
              type="text"
              id="new-contact"
              placeholder="03XXXXXXXXX"
              maxlength="11"
              oninput="
                this.value = this.value.replace(/[^0-9]/g, '');
                clearError('contact');
              "
            />
            <small
              id="err-contact"
              style="
                color: #dc2626;
                font-size: 0.8rem;
                display: none;
                margin-top: 4px;
              "
            >
              <i class="fa-solid fa-circle-exclamation"></i> Valid 11-digit
              number required
            </small>
          </div>

          <div>
            <label
              >Address
              <span style="color: #666; font-size: 0.85em"
                >(Optional)</span
              ></label
            >
            <input type="text" id="new-address" placeholder="Address" />
          </div>
        </div>

        <div style="margin-top: 20px">
          <button
            class="btn-primary"
            onclick="handleNewStudent()"
            style="width: 100%; justify-content: center; padding: 12px"
          >
            Confirm Admission
          </button>
        </div>
      </div>
    </div>

    <div id="receipt-modal" class="modal-overlay hidden">
      <div
        class="receipt-card"
        id="printable-receipt"
        style="width: 100%; max-width: 550px; padding: 30px"
      ></div>
    </div>

    <div id="user-modal" class="modal-overlay hidden">
      <div class="form-card" style="width: 450px; max-width: 95%">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
          "
        >
          <h3>Add User</h3>
          <button onclick="closeUserModal()">&times;</button>
        </div>
        <div class="form-grid" style="display: block; margin-top: 20px">
          <label>Username</label><input type="text" id="new-u-name" />
          <label>Password</label><input type="text" id="new-u-pass" />
          <label>Role</label>
          <select id="new-u-role">
            <option value="teacher">Teacher</option>
            <option value="admin">Admin</option>
          </select>
          <button
            class="btn-primary"
            onclick="handleAddUser()"
            style="width: 100%; margin-top: 20px"
          >
            Create
          </button>
        </div>
      </div>
    </div>

    <div
      id="slc-modal"
      class="modal-overlay hidden"
      style="
        align-items: flex-start;
        overflow-y: auto;
        padding: 20px 0;
        z-index: 9999;
      "
    >
      <div
        class="receipt-card"
        style="
          width: 210mm;
          max-width: none;
          padding: 40px;
          margin: 0 auto 50px auto;
          background: white;
        "
      >
        <div id="printable-slc"></div>

        <div
          class="modal-actions no-print"
          style="margin-top: 30px; text-align: center; padding-bottom: 20px"
        >
          <button
            onclick="
              document.getElementById('slc-modal').classList.add('hidden')
            "
            class="btn-secondary"
          >
            Close
          </button>
          <button onclick="window.print()" class="btn-primary">
            <i class="fa-solid fa-print"></i> Print Certificate
          </button>
        </div>
      </div>
    </div>

    <div id="toast-box" class="toast-container"></div>
    <script type="module">
  // 1. Hum direct internet links use kar rahe hain (CDN)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
  import { getDatabase, ref, set, get, child, onValue } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

  // 2. Aapka Config (Maine databaseURL add kar diya hai)
  const firebaseConfig = {
    apiKey: "AIzaSyAvxmiGPDS4ykv_68suzTxHuih_SVDADKw",
    authDomain: "mps-system-794e1.firebaseapp.com",
    
    // --- YE LINE ZAROORI HAI (Aapke Project ID se banayi hai) ---
    databaseURL: "https://mps-system-794e1-default-rtdb.firebaseio.com", 
    
    projectId: "mps-system-794e1",
    storageBucket: "mps-system-794e1.firebasestorage.app",
    messagingSenderId: "793833383656",
    appId: "1:793833383656:web:0c4accab88671e31a0cb5d"
  };

  // 3. App Start
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // 4. Inko Global bana rahe hain taake main.js use kar sake
  window.db = db;
  window.dbRef = ref;
  window.dbSet = set;
  window.dbGet = get;
  window.dbChild = child;
  window.dbOnValue = onValue;

  console.log("ðŸ”¥ Firebase Connected Successfully!");
</script>
<script src="js/main.js"></script>

<script src="js/main.js"></script>
  </body>
</html>


